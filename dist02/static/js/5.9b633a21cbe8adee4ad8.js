webpackJsonp([5],{NhnZ:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("Xxa5"),r=s.n(a),o=s("exGp"),i=s.n(o),l={data:function(){return{userList:[],total:0,pagesize:3,pagenum:1,searchText:"",isShowAddUserDialog:!1,addUserForm:{username:"",password:"",email:"",mobile:""},addUserRules:{username:[{required:!0,message:"长度在 3 到 6 个字符",min:3,max:6,trigger:"blur"}],password:[{required:!0,message:"长度在 6 到 12 个字符",min:6,max:12,trigger:"blur"}],email:[{pattern:/^([a-zA-Z0-9]+[_|_|.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|_|.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/,message:"请输入正确的邮箱格式",trigger:"blur"}],mobile:[{pattern:/^1(3|4|5|7|8)\d{9}$/,message:"手机号码格式不正确",trigger:"blur"}]},isShowEditUserDialog:!1,editUserForm:{username:"",email:"",mobile:"",id:""},editUserRules:{email:[{pattern:/^([a-zA-Z0-9]+[_|_|.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|_|.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/,message:"请输入正确的邮箱格式",trigger:"blur"}],mobile:[{pattern:/^1(3|4|5|7|8)\d{9}$/,message:"手机号码格式不正确",trigger:"blur"}]},isShowAssignRolesDialog:!1,assignRolesForm:{username:"",roleId:-1,userId:-1},rolesList:[]}},created:function(){this.getUserList(this.pagenum,this.searchText),this.getRolesList()},methods:{getUserList:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this.$http.get("/users",{params:{query:s,pagenum:t,pagesize:3}}).then(function(t){200===t.data.meta.status?(e.userList=t.data.data.users,e.total=t.data.data.total,e.pagenum=t.data.data.pagenum):(e.$router.push("/login"),localStorage.removeItem("token"))})},changePage:function(e){this.getUserList(e,this.searchText)},changeUserStatus:function(e){var t=this;this.$http.put("/users/"+e.id+"/state/"+e.mg_state,null).then(function(e){200===e.data.meta.status?t.$message({type:"success",message:e.data.meta.msg,duration:1e3}):t.$message({type:"error",message:e.data.meta.msg,duration:1e3})})},searchUser:function(){this.getUserList(1,this.searchText)},showAddUserDialog:function(){this.isShowAddUserDialog=!0},addUser:function(){var e=this;return i()(r.a.mark(function t(){var s;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$refs.addUserFormRef.validate();case 2:return t.next=4,e.$http.post("/users",e.addUserForm);case 4:201===(s=t.sent).data.meta.status&&(e.isShowAddUserDialog=!1,e.$message({type:"success",message:s.data.meta.msg}),e.getUserList(1,e.searchText));case 6:case"end":return t.stop()}},t,e)}))()},closeAddUserDialog:function(){this.$refs.addUserFormRef.resetFields()},deleteUserById:function(e){var t=this;return i()(r.a.mark(function s(){var a;return r.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,t.$confirm("您确定要删除此用户?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});case 3:return s.next=5,t.$http.delete("/users/"+e);case 5:200===(a=s.sent).data.meta.status?(t.$message({type:"success",message:a.data.meta.msg}),t.getUserList(1,t.searchText)):t.$message({type:"warning",message:a.data.meta.msg}),s.next=12;break;case 9:s.prev=9,s.t0=s.catch(0),t.$message({type:"info",message:"已取消删除"});case 12:case"end":return s.stop()}},s,t,[[0,9]])}))()},showUserEditDialog:function(e){var t=this;return i()(r.a.mark(function s(){var a;return r.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return t.isShowEditUserDialog=!0,s.next=3,t.$http("/users/"+e);case 3:200===(a=s.sent).data.meta.status?(t.editUserForm.username=a.data.data.username,t.editUserForm.mobile=a.data.data.mobile,t.editUserForm.email=a.data.data.email,t.editUserForm.id=a.data.data.id):t.$message({type:"error",message:a.data.meta.msg});case 5:case"end":return s.stop()}},s,t)}))()},editUser:function(){var e=this;return i()(r.a.mark(function t(){var s,a,o,i;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return s=e.editUserForm.id,a=e.editUserForm.email,o=e.editUserForm.mobile,t.next=5,e.$refs.editUserFormRef.validate();case 5:return t.next=7,e.$http.put("/users/"+s,{email:a,mobile:o});case 7:i=t.sent,e.isShowEditUserDialog=!1,200===i.data.meta.status?(e.$message({type:"success",message:i.data.meta.msg}),e.getUserList()):e.$message({type:"error",message:i.data.meta.msg});case 10:case"end":return t.stop()}},t,e)}))()},closeEditUserDialog:function(){this.$refs.editUserFormRef.resetFields()},showAssignRolesDialog:function(e){this.isShowAssignRolesDialog=!0;var t=this.rolesList.find(function(t){return t.roleName===e.role_name});this.assignRolesForm.roleId=t?t.id:"",this.assignRolesForm.username=e.username,this.assignRolesForm.userId=e.id},getRolesList:function(){var e=this;return i()(r.a.mark(function t(){var s;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$http.get("/roles");case 2:s=t.sent,e.rolesList=s.data.data;case 4:case"end":return t.stop()}},t,e)}))()},assignRoles:function(){var e=this;return i()(r.a.mark(function t(){var s,a,o,i;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return s=e.assignRolesForm,a=s.userId,o=s.roleId,t.next=3,e.$http.put("users/"+a+"/role",{rid:o});case 3:200===(i=t.sent).data.meta.status&&(e.isShowAssignRolesDialog=!1,e.$message({type:"success",message:i.data.meta.msg}),e.getUserList(e.pagenum,e.searchText));case 5:case"end":return t.stop()}},t,e)}))()}}},n={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"users"},[s("el-breadcrumb",{staticClass:"breadcrumb",attrs:{"separator-class":"el-icon-arrow-right"}},[s("el-breadcrumb-item",{attrs:{to:{path:"/home"}}},[e._v("首页")]),e._v(" "),s("el-breadcrumb-item",[e._v("用户管理")]),e._v(" "),s("el-breadcrumb-item",[e._v("用户列表")])],1),e._v(" "),s("el-row",{attrs:{gutter:20}},[s("el-col",{attrs:{span:8}},[s("el-input",{staticClass:"input-with-select",attrs:{placeholder:"请输入内容"},model:{value:e.searchText,callback:function(t){e.searchText=t},expression:"searchText"}},[s("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.searchUser},slot:"append"})],1)],1),e._v(" "),s("el-col",{attrs:{span:4}},[s("el-button",{attrs:{type:"success",icon:"el-icon-check",plain:""},on:{click:e.showAddUserDialog}},[e._v("\n        添加用户")])],1)],1),e._v(" "),s("el-table",{staticStyle:{width:"100%"},attrs:{data:e.userList,stripe:""}},[s("el-table-column",{attrs:{prop:"username",label:"姓名",width:"180"}}),e._v(" "),s("el-table-column",{attrs:{prop:"email",label:"邮箱",width:"180"}}),e._v('\n    v-model="scope.row.mg_state" '),s("el-table-column",{attrs:{prop:"mobile",label:"电话",width:"180"}}),e._v(" "),s("el-table-column",{attrs:{label:"用户状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-switch",{on:{change:function(s){e.changeUserStatus(t.row)}},model:{value:t.row.mg_state,callback:function(s){e.$set(t.row,"mg_state",s)},expression:"scope.row.mg_state"}})]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{type:"primary",icon:"el-icon-edit",size:"mini",plain:""},on:{click:function(s){e.showUserEditDialog(t.row.id)}}}),e._v(" "),s("el-button",{attrs:{type:"danger",icon:"el-icon-delete",size:"mini",plain:""},on:{click:function(s){e.deleteUserById(t.row.id)}}}),e._v(" "),s("el-button",{attrs:{type:"success",size:"mini",icon:"el-icon-check",plain:""},on:{click:function(s){e.showAssignRolesDialog(t.row)}}},[e._v("\n          分配角色\n        ")])]}}])})],1),e._v(" "),s("el-pagination",{attrs:{background:"",layout:"prev, pager, next",total:e.total,"page-size":e.pagesize,"current-page":e.pagenum},on:{"current-change":e.changePage}}),e._v(" "),s("el-dialog",{attrs:{title:"添加用户",visible:e.isShowAddUserDialog},on:{"update:visible":function(t){e.isShowAddUserDialog=t},close:e.closeAddUserDialog}},[s("el-form",{ref:"addUserFormRef",attrs:{model:e.addUserForm,"label-width":"120px",rules:e.addUserRules}},[s("el-form-item",{attrs:{label:"用户名称",prop:"username"}},[s("el-input",{model:{value:e.addUserForm.username,callback:function(t){e.$set(e.addUserForm,"username",t)},expression:"addUserForm.username"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"密码",prop:"password"}},[s("el-input",{model:{value:e.addUserForm.password,callback:function(t){e.$set(e.addUserForm,"password",t)},expression:"addUserForm.password"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[s("el-input",{model:{value:e.addUserForm.email,callback:function(t){e.$set(e.addUserForm,"email",t)},expression:"addUserForm.email"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"电话",prop:"mobile"}},[s("el-input",{model:{value:e.addUserForm.mobile,callback:function(t){e.$set(e.addUserForm,"mobile",t)},expression:"addUserForm.mobile"}})],1)],1),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.isShowAddUserDialog=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:e.addUser}},[e._v("确 定")])],1)],1),e._v(" "),s("el-dialog",{attrs:{title:"编辑用户",visible:e.isShowEditUserDialog},on:{"update:visible":function(t){e.isShowEditUserDialog=t},close:e.closeEditUserDialog}},[s("el-form",{ref:"editUserFormRef",attrs:{model:e.editUserForm,"label-width":"120px",rules:e.editUserRules}},[s("el-form-item",{attrs:{label:"用户名称",prop:"username"}},[s("el-tag",{attrs:{type:"info"}},[e._v(e._s(e.editUserForm.username))])],1),e._v(" "),s("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[s("el-input",{model:{value:e.editUserForm.email,callback:function(t){e.$set(e.editUserForm,"email",t)},expression:"editUserForm.email"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"电话",prop:"mobile"}},[s("el-input",{model:{value:e.editUserForm.mobile,callback:function(t){e.$set(e.editUserForm,"mobile",t)},expression:"editUserForm.mobile"}})],1)],1),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.isShowEditUserDialog=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:e.editUser}},[e._v("确 定")])],1)],1),e._v(" "),s("el-dialog",{attrs:{title:"分配角色",visible:e.isShowAssignRolesDialog},on:{"update:visible":function(t){e.isShowAssignRolesDialog=t}}},[s("el-form",{attrs:{model:e.assignRolesForm,"label-width":"120px"}},[s("el-form-item",{attrs:{label:"用户名"}},[s("el-tag",{attrs:{type:"info"}},[e._v(e._s(e.assignRolesForm.username))])],1),e._v(" "),s("el-form-item",{attrs:{label:"角色列表"}},[s("el-select",{attrs:{placeholder:"请选择用户角色"},model:{value:e.assignRolesForm.roleId,callback:function(t){e.$set(e.assignRolesForm,"roleId",t)},expression:"assignRolesForm.roleId"}},e._l(e.rolesList,function(e){return s("el-option",{key:e.id,attrs:{label:e.roleName,value:e.id}})}),1)],1)],1),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.isShowAssignRolesDialog=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:e.assignRoles}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var d=s("VU/8")(l,n,!1,function(e){s("khug")},null,null);t.default=d.exports},khug:function(e,t){}});
//# sourceMappingURL=5.9b633a21cbe8adee4ad8.js.map